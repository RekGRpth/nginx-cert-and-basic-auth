This is an example of an nginx configuration:

forward http to https
restrict access to a subdirectory
authenticate by client certificate
fallback to basic auth when certificate is nor available
